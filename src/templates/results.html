<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Sentiment Analysis Results</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .card {
      margin-bottom: 20px;
    }
    .card-img-top {
      height: 200px;
      object-fit: cover;
    }
    .loading {
      display: none;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div class="container">
  <h1 class="my-4">Sentiment Analysis Results</h1>
  <div class="row" id="articles-container">
    {% for article in articles %}
    <div class="col-md-4">
      <div class="card">
        <img src="{{ article.image }}" class="card-img-top" alt="Image not available">
        <div class="card-body">
          <h5 class="card-title">{{ article.title }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ article.author }}</h6>
          <p class="card-text">{{ article.description }}</p>
          <p class="card-text"><strong>Summary: </strong>{{ article.summary }}</p>
          <a href="{{ article.url }}" class="card-link" target="_blank">Read more</a>
          <p class="card-text mt-2"><strong>Sentiment: {{ article.sentiment }}</strong></p>
        </div>
        <div class="card-footer text-muted">
          Source: {{ article.source }} | Published: {{ article.published_at }}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="text-center mt-4">
    <button class="btn btn-primary" id="load-more-btn">Load More</button>
    <button class="btn btn-secondary" id="change-topic-btn">Change Search</button>
  </div>
  <div class="text-center mt-4 loading" id="loading-message">
    <p>Loading more articles...</p>
  </div>
</div>

<script>
  $(document).ready(function() {
    var offset = 10;
    var search = "{{ search }}";

    $('#load-more-btn').on('click', function() {
      $('#loading-message').show();
      $.ajax({
        url: '/load_more',
        type: 'POST',
        data: {
          search: search,
          offset: offset
        },
        success: function(response) {
          $('#loading-message').hide();
          if (response.status === 'success') {
            offset += 10;
            var articles = response.articles;
            articles.forEach(function(article) {
              var articleHtml = '<div class="col-md-4">' +
                      '<div class="card">' +
                      '<img src="' + article.image + '" class="card-img-top" alt="Image not available">' +
                      '<div class="card-body">' +
                      '<h5 class="card-title">' + article.title + '</h5>' +
                      '<h6 class="card-subtitle mb-2 text-muted">' + article.author + '</h6>' +
                      '<p class="card-text">' + article.description + '</p>' +
                      '<p class="card-text"><strong>Summary: </strong>' + article.summary + '</p>' +
                      '<a href="' + article.url + '" class="card-link" target="_blank">Read more</a>' +
                      '<p class="card-text mt-2"><strong>Sentiment: ' + article.sentiment + '</strong></p>' +
                      '</div>' +
                      '<div class="card-footer text-muted">' +
                      'Source: ' + article.source + ' | Published: ' + article.published_at +
                      '</div>' +
                      '</div>' +
                      '</div>';
              $('#articles-container').append(articleHtml);
            });
          } else {
            $('#load-more-btn').text('No more articles').prop('disabled', true);
          }
        }
      });
    });

    $('#change-topic-btn').on('click', function() {
      window.location.href = '/';
    });
  });
</script>
</body>
</html>
